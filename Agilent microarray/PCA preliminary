### Read in and normalise data
target <- readTargets("FAEE plus TLCS.txt" ) #import all the CER group and control group
rownames(target) <- removeExt(target$FileName)
target
RG <- read.maimages(target, source ="agilent") #read files

###return the expression data of each color from two color array
targets2 <- targetsA2C(target)
eset = exprs.MA(MA.reomoveCTprobe) #get the expression from MA
colnames(eset) <- rownames(targets2)
rownames(eset) <- MA.reomoveCTprobe$genes$GeneName


targets2 <- targets2 %>% 
  mutate(badvsgood=ifelse(grepl('bad',targets2$Target), 'badgroup', 'goodgroup')) %>% 
  mutate(modelgroup=ifelse(grepl('Control',targets2$Target),'Control', ifelse(grepl('Saline',targets2$Target), 
                                                                              'SC',ifelse(grepl('FAEE',targets2$Target), 'FAEE','TLCS'))))%>% 
  mutate(knockout=ifelse(grepl('ppif',targets2$Target), 'ppif', 'wt'))

PCA <- prcomp(t(eset), scale = FALSE)
percentVar <- round(100*PCA$sdev^2/sum(PCA$sdev^2),1)
sd_ratio <- sqrt(percentVar[2] / percentVar[1])
dataGG <- data.frame(PC1 = PCA$x[,1], PC2 = PCA$x[,2],
                     Model =
                       targets2$knockout)
ggplot(dataGG, aes(PC1, PC2)) +
  #geom_point(aes(shape = Model)) +
  geom_point(aes(colour = Model)) +
  ggtitle("PCA  in TLCS and FAEE") +
  xlab(paste0("PC1, VarExp: ", percentVar[1], "%")) +
  ylab(paste0("PC2, VarExp: ", percentVar[2], "%")) +
  theme(plot.title = element_text(hjust = 0.5)) +
  coord_fixed(ratio = sd_ratio) +
  #scale_shape_manual(values = c(1:5))
  scale_colour_manual(values = c('#e6194b', '#3cb44b', '#ffe119', '#4363d8', '#f58231', '#911eb4', '#46f0f0', '#f032e6', '#bcf60c', '#fabebe', '#008080', '#e6beff', '#9a6324', '#fffac8', '#800000', '#aaffc3', '#808000', '#ffd8b1', '#000075', '#808080', '#ffffff', '#000000','#CCFFFF', '#CCFFCC',	'#CCFF99','#CCFF66','#CCFF33','#CCFF00')) 


#sub group PCA
PCA <- prcomp(t(eset[, targets2$knockout %in% 'wt' ]), scale = FALSE) #subgroup in piff or wt
targets3 <- targets2[targets2$knockout %in% 'wt',]
percentVar <- round(100*PCA$sdev^2/sum(PCA$sdev^2),1)
sd_ratio <- sqrt(percentVar[2] / percentVar[1])
dataGG <- data.frame(PC1 = PCA$x[,1], PC2 = PCA$x[,2],
                     Model =
                       targets3$modelgroup)
ggplot(dataGG, aes(PC1, PC2)) +
  #geom_point(aes(shape = Model)) +
  geom_point(aes(colour = Model)) +
  #stat_ellipse(aes(x=PC1, y=PC2,color=Model),type = "norm") #not beautiful
  ggtitle("PCA (cluster experimental groups) in wt") +
  xlab(paste0("PC1, VarExp: ", percentVar[1], "%")) +
  ylab(paste0("PC2, VarExp: ", percentVar[2], "%")) +
  theme(plot.title = element_text(hjust = 0.5)) +
  coord_fixed(ratio = sd_ratio) +
  #scale_shape_manual(values = c(1:5))
  scale_colour_manual(values = c('#e6194b', '#3cb44b', '#ffe119', '#4363d8', '#f58231', '#911eb4', '#46f0f0', '#f032e6', '#bcf60c', '#fabebe', '#008080', '#e6beff', '#9a6324', '#fffac8', '#800000', '#aaffc3', '#808000', '#ffd8b1', '#000075', '#808080', '#ffffff', '#000000','#CCFFFF', '#CCFFCC',	'#CCFF99','#CCFF66','#CCFF33','#CCFF00')) 
